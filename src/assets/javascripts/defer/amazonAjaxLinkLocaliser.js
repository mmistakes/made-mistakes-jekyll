function localiseLinks(){!function e(){var a=Number(new Date)+5e3;"function"==typeof getCookie&&""!=getCookie("geo_country_code")?localiseAmazonLinks(getCookie("geo_country_code")):Number(new Date)<a&&setTimeout(e,500)}()}function updateQueryStringParameter(e,a,o){var n=new RegExp("([?&])"+a+"=.*?(&|$)","i"),i=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,"$1"+a+"="+o+"$2"):e+i+a+"="+o}function localiseAmazonLinks(e){if(e)for(var a=mapCountryCodesToAmazonRegion(e),o=mapRegionToTLD(a),n=document.querySelectorAll("a[href*='://www.amazon.']"),i=RegExp("([\\w-]+/)?(dp|gp/product)/(\\w+/)?(\\w{10})"),t=("doNotLocaliseLinksThatMatchRegionAlready"in window?doNotLocaliseLinksThatMatchRegionAlready:!1),r=0,f=n.length;f>r;r++){var l=n[r];l.setAttribute("rel","nofollow");var m=l.getAttribute("data-amazon-asin"),s=mapAmazonRegionToAffiliateTag(a);if(-1!=l.href.indexOf("&field-keywords=")||-1!=l.href.indexOf("?field-keywords=")){var d=l.href.split("://",2)[1].split("/",1)[0];l.href=l.href.replace("://"+d,"://www.amazon."+o),l.href=updateQueryStringParameter(l.href,"tag",s)}else if(m&&(amazonDataEntry=m.toUpperCase().match("\\["+a+"\\](\\s*\\[[a-zA-Z\\.]*\\])*\\s*(\\w*)\\s*($|\\[)"),amazonDataEntry))if(10==amazonDataEntry[2].length){if(t&&-1!=l.href.indexOf("://www.amazon."+o))continue;localiseASINTypeLink(amazonDataEntry[2],l,i,s,a)}else if(2==amazonDataEntry[2].length){var c=mapCountryCodesToAmazonRegion(amazonDataEntry[2]);if(t&&-1!=l.href.indexOf("://www.amazon."+mapRegionToTLD(c)))continue;var u=m.toUpperCase().match("\\["+c+"\\](\\s*\\[[a-zA-Z\\.]*\\])*\\s*(\\w{10})\\s*($|\\[)"),A=mapAmazonRegionToAffiliateTag(c);u&&10==u[2].length&&localiseASINTypeLink(u[2],l,i,A,c)}}}function localiseASINTypeLink(e,a,o,n,i){if(e&&a&&o&&n&&i){var t=a.href.match(o);if(t){var r=a.href.split("://",2)[1].split("/",1)[0];a.href=a.href.replace("://"+r,"://www.amazon."+mapRegionToTLD(i)),a.href=updateQueryStringParameter(a.href,"tag",n),a.href=a.href.split(t[4]).join(e)}}}function mapCountryCodesToAmazonRegion(e){return"amazonAffiliateRegions"in window?amazonAffiliateRegions[e]||amazonAffiliateRegions.DEFAULT:void 0}function mapAmazonRegionToAffiliateTag(e){if("amazonAffiliateTags"in window&&amazonAffiliateTags[e])return amazonAffiliateTags[e];var a="serek-eu-",o="-21";return["US","CA"].indexOf(e)>-1?o="-20":"CN"==e&&(o="-23"),a+e.toLowerCase()+o}function mapRegionToTLD(e){return"amazonAffiliateTLDs"in window?amazonAffiliateTLDs[e]:void 0}var amazonAffiliateTags={US:"oddoneout0a-20",CA:"oddoneout0f-20",DE:"oddoneout0c-21",UK:"oddoneout-21",ES:"oddoneout0e-21",IT:"oddoneout01-21",FR:"oddoneout0b-21",CN:"oddoneout-23",JP:"",MX:"",IN:"",BR:""},amazonAffiliateRegions={DE:"DE",AT:"DE",BE:"DE",DK:"DE",FI:"DE",NL:"DE",NO:"DE",PL:"DE",SE:"DE",LI:"DE",LU:"DE",ES:"ES",PT:"ES",AD:"ES",GB:"UK",UK:"UK",IE:"UK",IM:"UK",IT:"IT",VA:"IT",FR:"FR",CA:"CA",US:"US",CN:"US",BR:"US",IN:"US",MX:"US",DEFAULT:"US"},doNotLocaliseLinksThatMatchRegionAlready=!0,amazonAffiliateTLDs={DE:"de",UK:"co.uk",ES:"es",IT:"it",FR:"fr",CA:"ca",US:"com",CN:"cn",JP:"co.jp",MX:"com.mx",IN:"in",BR:"com.br"};localiseLinks();

